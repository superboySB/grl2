#!/bin/zsh

source activate grl

algo=$1
suite=$2
env=${suite}-$3
config=$4
s=$5
date=$(date -d '+8 hour' +"%m%d")
for x in $(seq 1 5); do
    shift
done

info=""

if [ -z "$info" ]; then
    n=$date
else
    n="$date-$info"
fi

kws="$@"
shift
kw1=""
kwstr="$kw1"
kws="$kws $kw1"
for item in $@; do
    if [ -z != $kwstr ]; then
        kwstr="$kwstr-$item"
    else
        kwstr="$item"
    fi
done


ld="$suite-logs"
if [ 0 != $# ]; then
    dir="$ld/$env/$algo/$n-$kwstr/seed=$s"
else
    dir="$ld/$env/$algo/$n/seed=$s"
fi
mkdir -p $dir
gpus=$(nvidia-smi -L | wc -l)
gpu=$((($s) % $gpus))
py_script="python run/train.py -a $algo -e $env -c $config -ld $ld --gpu $gpu -n $n -s $s $kws -i $info 2> ${dir}/err.txt | tee -a ${dir}/out.txt > /dev/null &"
echo $py_script
eval $py_script
